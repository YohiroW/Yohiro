---
title: 布料模拟
author: Yohiro
date: 2022-05-11
categories: [Physics, Engine]
tags: [engine, cloth, animation, physics, simulation]
render_with_liquid: false
math: true
img_path: /assets/images/Cloth/
---

## Intro

## MassSpring 模型

[Mass-Spring](https://graphicsinterface.org/wp-content/uploads/gi1995-17.pdf) 模型，顾名思义也就是将一块布料当作一张分布有许多质点，且质点间由弹簧互相连接构成的网。

### 质点

假设模拟的布料是一个均匀分布了 M × N 个质点的矩形，其中的每个质点具有自己的质量、位置以及速度。对于质量，可以认为同一块布料上各处质点的质量是均一的，即质量 $m$ 相同。

### 弹簧

对该系统内的质点，根据质点间连接方式的不同，将材质上每个质点所受到的弹性力分解为以下三种约束（Constraint）：

- 质点上下左右四个方向相连接的，用于模拟结构约束（Structural）
- 质点斜向对角相连接的，用于模拟剪切约束（Shear）
- 质点上下左右跨一个质点相连接的，用于模拟弯曲约束（Bend）

![图1](MassSpring.jpg)
_图1_

上述三种约束对应到材质上有下面抵抗形变的作用：

- 结构约束用于抵抗布料在垂直方向和水平方向的拉伸，结构约束越强越不易被拉伸
- 剪切约束用于抵抗扭曲，越强就越不会被剪切力所扭曲，更能在jie质点附近维持原有形状
- 弯曲约束用于抵抗弯曲，越强就不易弯曲，使得材质在视觉上显得质地更硬

![](VisualMassSpring.png)
_三种力对应三种不同的形变_

参考图 1，将各质点编码，对第 [i,j] 个质点的约束，它的各个约束所对应的点为：

结构约束：[i, j+1]，[i, j-1]，[i+1, j]，[i-1, j]
剪切约束：[i+1, j+1]，[i+1, j-1]，[i-1, j-1]，[i-1, j+1]
结构约束：[i, j+2]，[i, j-2]，[i+2, j]，[i-2, j]

可见对于单个质点而言，它需要周围 12 个质点的信息。

对于弹簧而言还有两个值得注意的变量，一个是弹簧的刚度（Stiffness）另一个是弹簧松弛状态下的初始长度（Rest length）。

上述的三种约束可以对应各自独立的刚度。对于我们常见的布料材质，通常剪切约束较弱，剪切约束的刚度对材质的视觉效果具有很大影响。此外，结构约束的刚度通常很大，而剪切约束和弯曲约束的刚度都很小[^Tip]。但这并不意味着这三种力是相互独立的，比如剪切约束也可以分解为水平方向和垂直方向的约束，可见剪切约束也会一定程度上影响材质的拉伸。

将质点所受到的这三种约束后形成的力记为 $F_s$，$F_s$ 将和其他外力一同用于计算质点的加速度。

### 其他

阻尼（Damping）
: 如果没有阻尼的限制，弹簧振子的将会无止境地弹下去，因此引入阻尼来模拟弹簧弹性渐弱，能量流失的过程。对材质阻尼系数为 $c_d$ 速度为 $v$ 的质点，阻尼力 $F_d$ 记为:
$$\begin{equation}
F_d = -c_d\,v
\end{equation}$$

重力
: 重力通常作为一个全局常量而存在，不过也不排除部分游戏中有以重力为核心的玩法，在这里我们将重力记为 $F_g$。

其他外力
: 至于其他的外力，比较常见的是风力，这些外力可统一记作 $F_e$。

### 模拟

对于合力 $F$，有

$$\begin{equation}
F = F_s + F_d + F_g + F_e
\end{equation}$$

然后根据牛二，获得了加速度 $a$

$$\begin{equation}
a = \frac{F}{m} = \frac{F_s + F_d + F_g + F_e}{m}
\end{equation}$$

有了加速度便可以根据 $t$ 时刻的速度和位置计算出 $t+1$ 时刻的速度和位置：

$$
v_{t+1} = v_t + a\,t
$$

$$
x_{t+1} = x_t + v\,t
$$

## 碰撞

由于布料存在于场景中必然会与其他对象发生交互，这就带来了另一个让人抠脑壳的问题，也就是布料与其他对象的碰撞。

### 布料-角色碰撞

对于布料-角色碰撞，通常的做法是用一系列简单的形状拼合成人形当作角色的代理，参考下图。

![PhysicalAsset](proxy.png){: .w-70}
_Blowing from the West: Simulating Wind in 'Ghost of Tsushima'_

但是仅仅使用这些碰撞体也存在问题。

### 布料-布料碰撞

## 限制


## 参考资料

[^Tip]: (Synthesis Lectures on Visual Computing Computer Graphics, Animation, Computational Photography, and Imaging, #24) Tuur Stuyck_ Brian A. Barsky - Cloth Simulation for Computer Graphics-Morgan & Clayp

- [CS114 Project 3:Cloth Simulation using Mass-Spring System](https://ics.uci.edu/~shz/courses/cs114/docs/proj3/index.html)
- [Blowing from the West: Simulating Wind in 'Ghost of Tsushima'](https://gdcvault.com/play/1027350/Blowing-from-the-West-Simulating)
- [Ten Minute Physics](https://matthias-research.github.io/pages/tenMinutePhysics/index.html)
